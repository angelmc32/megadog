class Game {
  constructor() {
    this.world = new World(2, 0.9);
  }

  update() {
    this.world.update();
  }
}

class World {
  constructor(gravity, friction) {
    this.background_color = "#808080";
    this.gravity = gravity;
    this.friction = friction;
    this.player = new Player(50, 50, "./images/gorduki_0.png", "./images/gordukip_0.png");
    this.columns = 10;
    this.rows = 8;
    this.tile_size = 64;
    this.map = [4,4,4,4,4,4,4,4,4,4,
                4,4,4,4,4,4,4,4,4,4,
                4,4,4,4,4,4,4,4,4,16,
                4,4,4,4,4,4,3,4,4,4,
                4,4,4,3,4,4,16,4,4,4,
                4,4,4,4,4,4,4,4,4,4,
                1,1,1,1,1,2,4,0,1,1,
                6,6,6,6,6,7,4,5,6,6];
    this.collision_map = []
    this.height = 480;
    this.width = 640;
  } 

  collideElement(element) {
    if (element.xPosition < 0) {
      element.xPosition = 0;
      element.xVelocity = 0;
    } else if (element.xPosition + element.width > this.width) {
      element.xPosition = this.width - element.width;
      element.xVelocity = 0;
    }

    if (element.yPosition < 0) {
      element.yPosition = 0;
      element.yVelocity = 0;
    } else if (element.yPosition + element.height > this.height) {
      element.jumpState = false;
      element.yPosition = this.height - element.height;
      element.yVelocity = 0;
    }

    
  }

  update() {
    this.player.yVelocity += this.gravity;
    this.player.update();
    this.player.xVelocity *= this.friction;
    this.player.yVelocity *= this.friction;

    this.collideElement(this.player);
  }
}

class Player {
  constructor(x, y, imageSource1, imageSource2) {
    this.image1 = new Image();
    this.image1.src = imageSource1;
    this.image2 = new Image();
    this.image2.src = imageSource2;
    this.color = "#ff0000";
    this.xPosition = x;
    this.yPosition = y;
    this.width = 64;
    this.height = 64;
    this.jumpState = true;
    this.xVelocity = 0;
    this.yVelocity = 0;
    this.charge = 0;
    this.chargedState = false;
    this.attacks = [];
  }

  jump() {
    if (!this.jumpState) {
      this.jumpState = true;
      this.yVelocity -= 32;
    }
  }

  moveLeft() {
    this.xVelocity -= 1;
  }

  moveRight() {
    this.xVelocity += 1;
  }

  attack() {
    if (this.charge < 90 && !this.chargedState) {
      let attack = new Attack(
        "./images/32ball.png",
        this.xPosition + 40,
        this.yPosition + 24,
        16,
        16,
        12
      );
      this.attacks.push(attack);
    } else {
      let attack = new Attack(
        "./images/32ball.png",
        this.xPosition + 16,
        this.yPosition + 16,
        48,
        48,
        15
      );
      this.attacks.push(attack);
      this.charge = 0;
      this.chargedState = false;
      console.log("Descargado :(");
    }
  }

  removeAttacks() {
    let filtered = this.attacks.filter(function(element, index, array) {
      return element.xPosition < 1024;
    });
    this.attacks = filtered;
  }

  update() {
    this.xPosition += this.xVelocity;
    this.yPosition += this.yVelocity;
    this.updateAttacks();
    this.removeAttacks();
  }

  updateAttacks() {
    for (let i = 0; i < this.attacks.length; i++) {
      this.attacks[i].xPosition += this.attacks[i].xSpeed;
    }
  }
}

class Attack {
  constructor(imageSource, x, y, height, width, xSpeed) {
    this.image = new Image();
    this.image.src = imageSource;
    this.xPosition = x;
    this.yPosition = y;
    this.height = height;
    this.width = width;
    this.xSpeed = xSpeed;
  }
}

/*
this.map = [49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,
                49,18,18,18,50,49,19,20,17,18,36,37,11,40,40,40,17,19,40,32,32,32,40,08,11,32,40,32,32,32,40,13,06,06,29,02,00,00,00,00,11,40,40,40,17,19,40,32,32,32,40,08,11,40,40,40,17,19,40,32,32,32,40,08,];
*/
